<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Thai Fabric Pattern Analyzer - ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏•‡∏ß‡∏î‡∏•‡∏≤‡∏¢</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            thai: {
              gold: '#FFD700',
              red: '#DC143C',
              blue: '#1E3A8A',
              green: '#059669'
            }
          }
        }
      }
    }
  </script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
  <script src="{{ url_for('static', filename='js/script.js') }}" defer></script>
</head>

<body class="bg-gradient-to-br from-orange-50 to-red-50 min-h-screen flex flex-col">

  <!-- Navigation -->
  <nav class="bg-white shadow-lg sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <div class="flex items-center space-x-3">
          <div
            class="w-10 h-10 bg-gradient-to-r from-thai-gold to-thai-red rounded-lg flex items-center justify-center">
            <span class="text-white font-bold text-lg">üßµ</span>
          </div>
          <span class="text-xl font-bold text-gray-800">AI Thai Fabric</span>
        </div>
        <div class="hidden md:flex space-x-8">
          <a href="{{ url_for('home') }}" class="nav-btn text-gray-700 hover:text-thai-red font-medium">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
          <a href="{{ url_for('analyzer') }}" class="nav-btn text-thai-red font-medium">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏•‡∏ß‡∏î‡∏•‡∏≤‡∏¢</a>
          <a href="{{ url_for('database') }}"
            class="nav-btn text-gray-700 hover:text-thai-red font-medium">‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡πâ‡∏≤‡πÑ‡∏ó‡∏¢</a>
          <a href="{{ url_for('technology') }}"
            class="nav-btn text-gray-700 hover:text-thai-red font-medium">‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ</a>
          <a href="{{ url_for('about') }}"
            class="nav-btn text-gray-700 hover:text-thai-red font-medium">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤</a>
        </div>
        <div class="md:hidden">
          <button onclick="toggleMobileMenu()" class="text-gray-700" aria-label="Toggle menu">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>
    <!-- Mobile Menu -->
    <div id="mobileMenu" class="hidden md:hidden bg-white border-t">
      <div class="px-2 pt-2 pb-3 space-y-1">
        <a href="{{ url_for('home') }}" class="block px-3 py-2 text-gray-700 hover:text-thai-red">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
        <a href="{{ url_for('analyzer') }}" class="block px-3 py-2 text-thai-red">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏•‡∏ß‡∏î‡∏•‡∏≤‡∏¢</a>
        <a href="{{ url_for('database') }}"
          class="block px-3 py-2 text-gray-700 hover:text-thai-red">‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡πâ‡∏≤‡πÑ‡∏ó‡∏¢</a>
        <a href="{{ url_for('technology') }}" class="block px-3 py-2 text-gray-700 hover:text-thai-red">‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ</a>
        <a href="{{ url_for('about') }}" class="block px-3 py-2 text-gray-700 hover:text-thai-red">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤</a>
      </div>
    </div>
  </nav>

  <!-- Analyzer Section -->
  <section id="analyzer" class="section-content flex-1">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-12">

      <!-- Header -->
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">üîç ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏•‡∏ß‡∏î‡∏•‡∏≤‡∏¢‡∏ú‡πâ‡∏≤‡πÑ‡∏ó‡∏¢</h1>
        <p class="text-gray-600">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏ú‡πâ‡∏≤‡πÑ‡∏ó‡∏¢ (‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏•‡∏ß‡∏î‡∏•‡∏≤‡∏¢</p>
      </div>

      <!-- Upload Form -->
      <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
        <form action="{{ url_for('analyzer') }}" method="POST" enctype="multipart/form-data" class="space-y-4">
          <div id="uploadArea" class="upload-area rounded-lg p-12 text-center cursor-pointer">
            <!-- Default State -->
            <div id="uploadContent">
              <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="text-3xl">üì∑</span>
              </div>
              <h3 class="text-xl font-semibold text-gray-700 mb-2">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ú‡πâ‡∏≤‡πÑ‡∏ó‡∏¢</h3>
              <p class="text-gray-500 mb-4">‡∏•‡∏≤‡∏Å‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå ‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á</p>
              <div class="flex flex-col sm:flex-row justify-center gap-4">
                <button id="chooseFileBtn" type="button"
                  class="bg-thai-blue hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</button>
                <button id="cameraBtn" type="button"
                  class="bg-thai-green hover:bg-green-700 text-white px-6 py-2 rounded-lg transition-colors">üì∏
                  ‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û</button>
              </div>

              <!-- Hidden inputs -->
              <input type="file" name="images" id="fileInput" class="hidden" accept="image/*" multiple>
              <input type="file" id="cameraInput" class="hidden" accept="image/*" capture="environment">
            </div>

            <!-- Preview State -->
            <div id="imagePreview" class="hidden">
              <div id="previewContainer" class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4"></div>
              <p class="text-gray-600 mb-4">‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</p>
              <div class="flex flex-col sm:flex-row justify-center gap-4 mb-4">
                <button type="submit"
                  class="bg-thai-red hover:bg-red-700 text-white px-8 py-3 rounded-lg font-semibold transition-colors">
                  üß† ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏•‡∏ß‡∏î‡∏•‡∏≤‡∏¢
                </button>
                <button type="reset" id="removeImgBtn"
                  class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-6 py-3 rounded-lg font-semibold transition-colors">
                  ‚ùå ‡∏•‡∏ö/‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ
                </button>
              </div>
            </div>
          </div>
        </form>

        <!-- Camera Modal -->
        <div id="cameraModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
          <div class="bg-white rounded-xl p-6 shadow-lg max-w-md w-full relative flex flex-col items-center">
            <video id="cameraVideo" autoplay playsinline class="rounded-lg w-full max-h-72 mb-4 bg-black"></video>
            <div class="flex gap-4 w-full justify-center">
              <button id="captureBtn"
                class="bg-thai-blue hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-semibold transition-colors">
                ‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û
              </button>
              <button id="closeCameraBtn"
                class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-6 py-2 rounded-lg font-semibold transition-colors">
                ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
              </button>
            </div>
            <canvas id="cameraCanvas" class="hidden"></canvas>
          </div>
        </div>
      </div>

      <!-- Analysis Result -->
      {% if results %}
      <div class="bg-white rounded-xl shadow-lg p-8">
        <h3 class="text-2xl font-bold text-center text-gray-800 mb-6">
          üìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå ({{ results|length }} ‡∏†‡∏≤‡∏û)
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {% for r in results %}
          <div class="border rounded-xl shadow p-4">
            <img class="w-full h-48 object-cover rounded-lg mb-4"
              src="{{ url_for('static', filename='uploads/' ~ r.get('filename','')) }}" alt="‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î">

            {% if r.get('unknown', False) %}
            <h4 class="text-xl font-bold text-red-600">‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏•‡∏ß‡∏î‡∏•‡∏≤‡∏¢‡∏ú‡πâ‡∏≤‡πÑ‡∏ó‡∏¢‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h4>
            <p>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î: {{ ((r.get('confidence',0)*100)|round(2)) }}%</p>
            {% else %}
            <h4 class="text-xl font-bold text-thai-red">{{ r.get('label_th','-') }}</h4>
            <p>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡πâ‡∏≤: {{ r.get('class_id','-') }}</p>
            <p>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î: {{ r.get('province','-') }} | ‡∏†‡∏≤‡∏Ñ: {{ r.get('region','-') }}</p>
            <p>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à: {{ ((r.get('confidence',0)*100)|round(2)) }}%</p>
            <a href="{{ url_for('fabric_detail', fabric_name=r.get('slug','')) }}"
              class="text-thai-blue hover:underline">
              üìö ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
            </a>



            {% endif %}

            <!-- Metrics -->
            <div class="mt-3 text-sm text-gray-700">
              <p>Loss: {{ (r.get('loss',0))|round(4) }}</p>
              <p>
                Margin: {{ (r.get('margin',0))|round(3) }}
                | Entropy: {{ (r.get('entropy',0))|round(3) }}
                | Texture: {{ (r.get('texture',0))|round(1) }}
                {% if r.get('similarity') is not none %}
                | CosSim: {{ (r.get('similarity',0))|round(3) }}
                {% endif %}
              </p>
            </div>


          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <div class="flex items-center justify-center space-x-3 mb-4">
        <div class="w-8 h-8 bg-gradient-to-r from-thai-gold to-thai-red rounded-lg flex items-center justify-center">
          <span class="text-white font-bold">üßµ</span>
        </div>
        <span class="text-xl font-bold">AI Thai Fabric</span>
      </div>
      <p class="text-gray-400">‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ AI ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏ô‡∏∏‡∏£‡∏±‡∏Å‡∏©‡πå‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏°‡∏£‡∏î‡∏Å‡∏ó‡∏≤‡∏á‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°‡πÑ‡∏ó‡∏¢</p>
    </div>
  </footer>

</body>

</html>